<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Directorio de contactos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Tipografías: Bebas Neue (títulos) y Montserrat (texto) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Montserrat:wght@300;400;500&display=swap" rel="stylesheet">

  <style>
    :root {
      --c-dark: #5F6F52;
      --c-soft: #A9B388;
      --c-light: #FEFAE0;
      --c-accent: #B99470;
      --radius-lg: 18px;
      --radius-md: 12px;
      --shadow-soft: 0 10px 30px rgba(0,0,0,0.08);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 24px;
      background: radial-gradient(circle at top left, #ffffff 0, var(--c-light) 45%, #f7f2e4 100%);
      font-family: "Montserrat", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      font-weight: 300;
      color: #2f2f2f;
    }

    .container {
      max-width: 1100px;
      margin: 0 auto;
      background: rgba(255,255,255,0.95);
      border-radius: 24px;
      padding: 26px 28px 20px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(95,111,82,0.18);
      backdrop-filter: blur(4px);
    }

    header {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-bottom: 18px;
    }

    h1 {
      margin: 0;
      font-family: "Bebas Neue", system-ui, sans-serif;
      letter-spacing: 0.06em;
      font-size: 30px;
      color: var(--c-dark);
      text-transform: uppercase;
    }

    .subtitle {
      font-size: 13px;
      color: #5e5e5e;
      max-width: 720px;
    }

    .controls {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 16px;
    }

    .password-toggle {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 8px;
      font-size: 11px;
      color: #555555;
      background: #fdf9ef;
      border-radius: 999px;
      padding: 6px 10px;
      border: 1px solid rgba(185,148,112,0.35);
    }

    .password-toggle button {
      padding: 4px 12px;
      font-size: 11px;
      border-radius: 999px;
      border: 1px solid var(--c-accent);
      background: var(--c-accent);
      color: #ffffff;
      cursor: pointer;
      font-family: inherit;
      font-weight: 400;
    }

    .password-toggle button:hover {
      background: #a87349;
      border-color: #a87349;
    }

    .search-bar input {
      width: 100%;
      padding: 10px 16px;
      border-radius: 999px;
      border: 1px solid rgba(95,111,82,0.3);
      font-size: 14px;
      outline: none;
      background: #fbf8ee;
    }

    .search-bar input::placeholder {
      color: #a0a0a0;
      font-size: 13px;
    }

    .search-bar input:focus {
      border-color: var(--c-dark);
      box-shadow: 0 0 0 2px rgba(95,111,82,0.12);
      background: #ffffff;
    }

    .alpha-filter {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }

    .alpha-btn {
      border-radius: 999px;
      border: 1px solid rgba(95,111,82,0.25);
      background: rgba(254,250,224,0.9);
      font-size: 11px;
      padding: 3px 9px;
      cursor: pointer;
      font-family: inherit;
      color: #444444;
    }

    .alpha-btn:hover {
      background: #f0ead0;
    }

    .alpha-btn.active {
      background: var(--c-dark);
      color: #ffffff;
      border-color: var(--c-dark);
    }

    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 14px;
    }

    .contact-card {
      border-radius: var(--radius-lg);
      background: linear-gradient(145deg, #ffffff, #fbf7ec);
      border: 1px solid rgba(169,179,136,0.5);
      padding: 14px 14px 12px;
      box-shadow: 0 4px 14px rgba(0,0,0,0.04);
      display: flex;
      flex-direction: column;
      gap: 8px;
      position: relative;
      overflow: hidden;
    }

    .contact-card::before {
      content: "";
      position: absolute;
      inset: 0;
      pointer-events: none;
      background: radial-gradient(circle at top right, rgba(185,148,112,0.12), transparent 55%);
      opacity: 0.7;
    }

    .contact-card-inner {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      align-items: flex-start;
    }

    .card-title-block {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .card-initial {
      width: 34px;
      height: 34px;
      border-radius: 50%;
      background: var(--c-dark);
      color: #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: "Bebas Neue", system-ui, sans-serif;
      letter-spacing: 0.06em;
      font-size: 18px;
      text-transform: uppercase;
      box-shadow: 0 4px 10px rgba(0,0,0,0.18);
    }

    .card-title-text {
      display: flex;
      flex-direction: column;
      gap: 1px;
    }

    .card-name {
      font-family: "Bebas Neue", system-ui, sans-serif;
      font-size: 20px;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: #3b4632;
      line-height: 1;
    }

    .card-razon {
      font-size: 11px;
      color: #666666;
    }

    .type-pill {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 2px 10px;
      border-radius: 999px;
      font-size: 10px;
      border: 1px solid rgba(95,111,82,0.4);
      background: rgba(95,111,82,0.08);
      color: #36412b;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-weight: 500;
      white-space: nowrap;
    }

    .type-pill.persona {
      background: rgba(169,179,136,0.25);
    }

    .type-pill.empresa {
      background: rgba(185,148,112,0.18);
    }

    .card-meta {
      display: flex;
      flex-direction: column;
      gap: 3px;
      font-size: 11px;
    }

    .meta-row {
      display: flex;
      gap: 6px;
      align-items: baseline;
    }

    .meta-label {
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-size: 9px;
      color: #777777;
      min-width: 68px;
    }

    .meta-value, .meta-link {
      font-size: 11px;
      color: #333333;
      text-decoration: none;
      word-break: break-word;
    }

    .meta-link {
      color: var(--c-dark);
      border-bottom: 1px dotted rgba(95,111,82,0.35);
    }

    .meta-link:hover {
      color: #3c4934;
      border-bottom-style: solid;
    }

    .card-section {
      border-top: 1px dashed rgba(185,148,112,0.45);
      padding-top: 5px;
      margin-top: 3px;
      font-size: 11px;
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .section-title {
      text-transform: uppercase;
      letter-spacing: 0.12em;
      font-size: 9px;
      color: #8a765b;
    }

    .cred-entry {
      font-size: 11px;
      line-height: 1.35;
    }

    .password-text {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    .empty-state {
      grid-column: 1 / -1;
      text-align: center;
      padding: 30px 10px;
      font-size: 13px;
      color: #777777;
      border-radius: var(--radius-md);
      border: 1px dashed rgba(169,179,136,0.7);
      background: #fbf7ec;
    }

    .status {
      margin-top: 10px;
      font-size: 11px;
      color: #777777;
      text-align: right;
    }

    @media (max-width: 640px) {
      body {
        padding: 12px;
      }
      .container {
        padding: 18px 16px 16px;
        border-radius: 18px;
      }
      .card-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 4px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Directorio de contactos</h1>
      <div class="subtitle">
        Usa el buscador y el filtro alfabético para encontrar contactos por nombre, razón social o cualquier otro campo.
      </div>
    </header>

    <div class="controls">
      <div class="password-toggle">
        <span id="password-status">
          Contraseñas ocultas. Esta protección es solo visual, no es segura para datos sensibles.
        </span>
        <button id="password-toggle-btn" type="button">Desbloquear</button>
      </div>

      <div class="search-bar">
        <input id="search" type="text" placeholder="Buscar por nombre, razón social, correo, plataforma, etc.">
      </div>

      <div id="alpha-filter" class="alpha-filter"></div>
    </div>

    <div id="cards" class="cards-grid"></div>

    <div id="estado" class="status"></div>
  </div>

  <!-- PapaParse: librería para leer CSV -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

  <script>
    // 1) Pega aquí la URL CSV de tu Google Sheet
    const CSV_URL = 'https://docs.google.com/spreadsheets/d/1T3jxg376sNzDJ1IRGRwtowGmmfenfqXPtHrIqEltB1c/export?format=csv&id=1T3jxg376sNzDJ1IRGRwtowGmmfenfqXPtHrIqEltB1c&gid=0';

    // 2) Contraseña maestra para mostrar contraseñas (solo protección visual)
    const MASTER_PASSWORD = '7540';

    let contactos = [];
    let searchInput;
    let cardsContainer;
    let estado;
    let letterFilter = '';
    let masterUnlocked = false;
    let alphaContainer;
    let passwordStatus;
    let passwordToggleBtn;

    function normalizar(texto) {
      return (texto || '')
        .toString()
        .toLowerCase()
        .normalize('NFD')
        .replace(/[\u0300-\u036f]/g, '');
    }

    function parseListaCampo(campo) {
      if (!campo) return [];
      return campo
        .toString()
        .split(';')
        .map(s => s.trim())
        .filter(Boolean);
    }

    function inicialDe(item) {
      const base = (item.nombre || item.razonSocial || '').trim();
      if (!base) return '?';
      const ch = base[0].toUpperCase();
      if (ch >= 'A' && ch <= 'Z') return ch;
      return '#';
    }

    function render(lista) {
      cardsContainer.innerHTML = '';

      if (!Array.isArray(lista) || lista.length === 0) {
        const empty = document.createElement('div');
        empty.className = 'empty-state';
        empty.textContent = 'No hay resultados para tu búsqueda.';
        cardsContainer.appendChild(empty);
        estado.textContent = '0 contactos encontrados.';
        return;
      }

      lista.forEach(function(item) {
        const card = document.createElement('article');
        card.className = 'contact-card';

        const inner = document.createElement('div');
        inner.className = 'contact-card-inner';

        // Header
        const header = document.createElement('div');
        header.className = 'card-header';

        const titleBlock = document.createElement('div');
        titleBlock.className = 'card-title-block';

        const initialCircle = document.createElement('div');
        initialCircle.className = 'card-initial';
        initialCircle.textContent = inicialDe(item);

        const titleText = document.createElement('div');
        titleText.className = 'card-title-text';

        const nameEl = document.createElement('div');
        nameEl.className = 'card-name';
        nameEl.textContent = item.nombre || (item.razonSocial || 'Sin nombre');

        titleText.appendChild(nameEl);

        if (item.razonSocial) {
          const razonEl = document.createElement('div');
          razonEl.className = 'card-razon';
          razonEl.textContent = item.razonSocial;
          titleText.appendChild(razonEl);
        }

        titleBlock.appendChild(initialCircle);
        titleBlock.appendChild(titleText);

        header.appendChild(titleBlock);

        if (item.tipo) {
          const tipoSpan = document.createElement('span');
          tipoSpan.className = 'type-pill ' + normalizar(item.tipo);
          tipoSpan.textContent = item.tipo;
          header.appendChild(tipoSpan);
        }

        inner.appendChild(header);

        // Meta (teléfono, correo)
        const meta = document.createElement('div');
        meta.className = 'card-meta';

        if (item.telefono) {
          const row = document.createElement('div');
          row.className = 'meta-row';

          const label = document.createElement('div');
          label.className = 'meta-label';
          label.textContent = 'Teléfono';

          const value = document.createElement('a');
          value.className = 'meta-link';
          value.href = 'tel:' + item.telefono.toString().replace(/\s+/g, '');
          value.textContent = item.telefono;

          row.appendChild(label);
          row.appendChild(value);
          meta.appendChild(row);
        }

        if (item.correo) {
          const row = document.createElement('div');
          row.className = 'meta-row';

          const label = document.createElement('div');
          label.className = 'meta-label';
          label.textContent = 'Correo';

          const value = document.createElement('a');
          value.className = 'meta-link';
          value.href = 'mailto:' + item.correo;
          value.textContent = item.correo;

          row.appendChild(label);
          row.appendChild(value);
          meta.appendChild(row);
        }

        if (meta.children.length > 0) {
          inner.appendChild(meta);
        }

        // Credenciales (plataforma, usuario, contraseña)
        const plataformas = parseListaCampo(item.plataformas);
        const usuarios = parseListaCampo(item.usuarios);
        const contrasenas = parseListaCampo(item.contrasenas);
        const maxLen = Math.max(plataformas.length, usuarios.length, contrasenas.length);

        if (maxLen > 0) {
          const credSection = document.createElement('div');
          credSection.className = 'card-section';

          const title = document.createElement('div');
          title.className = 'section-title';
          title.textContent = 'Credenciales';
          credSection.appendChild(title);

          for (let i = 0; i < maxLen; i++) {
            const div = document.createElement('div');
            div.className = 'cred-entry';

            const partes = [];
            const pl = plataformas[i] || '';
            const us = usuarios[i] || '';
            const pw = contrasenas[i] || '';

            if (pl) partes.push(pl);
            if (us) partes.push(us);

            const textoSpan = document.createElement('span');
            textoSpan.textContent = partes.join(' · ');
            div.appendChild(textoSpan);

            if (pw) {
              const sep = document.createElement('span');
              sep.textContent = ' • ';
              div.appendChild(sep);

              const pwSpan = document.createElement('span');
              pwSpan.className = 'password-text';
              pwSpan.textContent = masterUnlocked ? pw : '••••••••';
              div.appendChild(pwSpan);
            }

            credSection.appendChild(div);
          }

          inner.appendChild(credSection);
        }

        // Dirección y notas
        if (item.direccion || item.notas) {
          const extraSection = document.createElement('div');
          extraSection.className = 'card-section';

          const title = document.createElement('div');
          title.className = 'section-title';
          title.textContent = 'Información adicional';
          extraSection.appendChild(title);

          if (item.direccion) {
            const row = document.createElement('div');
            row.className = 'cred-entry';
            row.textContent = 'Dirección: ' + item.direccion;
            extraSection.appendChild(row);
          }

          if (item.notas) {
            const row = document.createElement('div');
            row.className = 'cred-entry';
            row.textContent = 'Notas: ' + item.notas;
            extraSection.appendChild(row);
          }

          inner.appendChild(extraSection);
        }

        card.appendChild(inner);
        cardsContainer.appendChild(card);
      });

      estado.textContent = lista.length + ' contacto(s) mostrados.';
    }

    function filtrar() {
      const q = normalizar(searchInput.value);
      let lista = contactos.slice();

      if (q) {
        lista = lista.filter(function(item) {
          return (
            normalizar(item.nombre).includes(q) ||
            normalizar(item.razonSocial).includes(q) ||
            normalizar(item.tipo).includes(q) ||
            normalizar(item.telefono).includes(q) ||
            normalizar(item.correo).includes(q) ||
            normalizar(item.plataformas).includes(q) ||
            normalizar(item.usuarios).includes(q) ||
            normalizar(item.contrasenas).includes(q) ||
            normalizar(item.direccion).includes(q) ||
            normalizar(item.notas).includes(q)
          );
        });
      }

      if (letterFilter) {
        lista = lista.filter(function(item) {
          return inicialDe(item) === letterFilter;
        });
      }

      render(lista);
    }

    function cargarDatos() {
      estado.textContent = 'Cargando contactos...';

      fetch(CSV_URL)
        .then(function(resp) {
          if (!resp.ok) {
            throw new Error('No se pudo cargar el CSV, código ' + resp.status);
          }
          return resp.text();
        })
        .then(function(texto) {
          const resultado = Papa.parse(texto, {
            header: true,
            skipEmptyLines: true
          });

          if (resultado.errors && resultado.errors.length > 0) {
            console.error('Errores al parsear CSV:', resultado.errors);
          }

          contactos = resultado.data.map(function(row) {
            return {
              nombre: row.Nombre || '',
              razonSocial: row.RazonSocial || '',
              tipo: row.Tipo || '',
              telefono: row.Telefono || '',
              correo: row.Correo || '',
              plataformas: row.Plataformas || '',
              usuarios: row.Usuarios || '',
              contrasenas: row.Contrasenas || '',
              direccion: row.Direccion || '',
              notas: row.Notas || ''
            };
          });

          // Orden alfabético por nombre / razón social
          contactos.sort(function(a, b) {
            const keyA = normalizar(a.nombre || a.razonSocial);
            const keyB = normalizar(b.nombre || b.razonSocial);
            if (keyA < keyB) return -1;
            if (keyA > keyB) return 1;
            return 0;
          });

          filtrar();
        })
        .catch(function(err) {
          console.error(err);
          estado.textContent = 'Error al cargar datos. Revisa la URL del CSV y los permisos de la hoja.';
        });
    }

    function inicializarFiltroAlfa() {
      const letras = ['Todos'];
      for (let i = 0; i < 26; i++) {
        letras.push(String.fromCharCode(65 + i));
      }

      letras.forEach(function(lbl) {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'alpha-btn';
        btn.textContent = lbl;
        btn.dataset.letter = (lbl === 'Todos') ? '' : lbl;

        if (lbl === 'Todos') {
          btn.classList.add('active');
        }

        btn.addEventListener('click', function() {
          letterFilter = btn.dataset.letter;
          const todosBotones = alphaContainer.querySelectorAll('.alpha-btn');
          todosBotones.forEach(function(b) {
            b.classList.remove('active');
          });
          btn.classList.add('active');
          filtrar();
        });

        alphaContainer.appendChild(btn);
      });
    }

    function inicializarPasswordToggle() {
      passwordToggleBtn.addEventListener('click', function() {
        if (!masterUnlocked) {
          const intento = prompt(
            'Introduce la contraseña maestra para mostrar las contraseñas.\n' +
            'AVISO: esta protección es solo visual. No es segura para información sensible.'
          );
          if (intento === null) return;
          if (intento === MASTER_PASSWORD) {
            masterUnlocked = true;
            passwordStatus.textContent = 'Contraseñas visibles (protección solo visual, no segura).';
            passwordToggleBtn.textContent = 'Ocultar';
            filtrar();
          } else {
            alert('Contraseña incorrecta.');
          }
        } else {
          masterUnlocked = false;
          passwordStatus.textContent = 'Contraseñas ocultas. Esta protección es solo visual, no es segura para datos sensibles.';
          passwordToggleBtn.textContent = 'Desbloquear';
          filtrar();
        }
      });
    }

    document.addEventListener('DOMContentLoaded', function() {
      searchInput = document.getElementById('search');
      cardsContainer = document.getElementById('cards');
      estado = document.getElementById('estado');
      alphaContainer = document.getElementById('alpha-filter');
      passwordStatus = document.getElementById('password-status');
      passwordToggleBtn = document.getElementById('password-toggle-btn');

      searchInput.addEventListener('input', filtrar);

      inicializarFiltroAlfa();
      inicializarPasswordToggle();
      cargarDatos();
    });
  </script>
</body>
</html>
